<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>緊急時対応マニュアル</title>

<style>
  body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP",sans-serif;margin:0;background:#f8f9fa;color:#111;line-height:1.7;font-size:16px;}
  .wrapper{max-width:520px;margin:0 auto;padding:14px;}
  h1{text-align:center;font-size:20px;color:#dc2626;margin-bottom:10px;}

  .section{background:#fff;border-radius:12px;margin-bottom:14px;overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,0.1);}
  .header{padding:12px;display:flex;justify-content:space-between;cursor:pointer;user-select:none;}
  .header-title{font-size:16px;font-weight:600;}
  .sub-title{font-size:13px;color:#6b7280;margin-top:2px;}
  .arrow{transition:0.2s;}
  .open .arrow{transform:rotate(90deg);}
  .body{display:none;padding:12px;background:#f9fafb;}
  .open .body{display:block;}

  .steps{margin-top:8px;padding-left:18px;}
  .steps li{margin-bottom:8px;font-size:14px;}

  .point{margin-top:10px;padding:10px;background:#fff7ed;border-left:4px solid #fb923c;border-radius:6px;font-size:14px;color:#b45309;}
</style>
  <script>
    async function loadChecks() {
      const userId = window.MANUAL_USER_ID;
      const store  = window.MANUAL_STORE;
      const type   = window.MANUAL_TYPE;   // ← これが重要（undefined の原因だった）

      if (!userId || !store || !type) {
        console.warn("チェックロード不可: userId/store/type が不足");
        return;
      }

      const res = await fetch(`/${store}/manual-check?userId=${userId}&type=${type}`);
      if (!res.ok) return;

      let data = {};
      try {
        data = await res.json();
      } catch (e) {
        console.error("JSON parse error:", e);
        return;
      }

      // 反映
      document.querySelectorAll(".check-item").forEach(el => {
        const key = el.dataset.key;
        if (data[key] === true) el.checked = true;
      });
    }

    // チェック変更イベント
    async function toggleCheck(key) {
      const userId = window.MANUAL_USER_ID;
      const store  = window.MANUAL_STORE;
      const type   = window.MANUAL_TYPE;

      const res = await fetch(`/${store}/manual-check`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId, type, recipeId: key })
      });

      const out = await res.json();
      console.log("CHECK UPDATED:", out);
    }

    window.addEventListener("DOMContentLoaded", loadChecks);
  </script>

  <script>
    function saveCheck(key) {
      toggleCheck(key);
    }
  </script>
</head>

<body>
<div class="wrapper">

<h1>緊急時対応マニュアル</h1>
<p style="text-align:center;font-size:13px;color:#6b7280;margin-bottom:16px;">
  クレーム・強盗・商品入れ忘れ・事故・体調不良など
</p>

<!-- クレーム対応 -->
<div class="section">
  <div class="header">
    <div>
        <div class="header-title recipe-name" data-recipe-id="クレーム対応">クレーム対応</div>
      <div class="sub-title">最も発生率が高いトラブル</div>
    </div>
    <div class="arrow">▶</div>
  </div>

  <div class="body">
    <strong>【基本姿勢】</strong>
    <ol class="steps">
      <li>とにかく“遮らず聞く”姿勢を保つ</li>
      <li>否定せず「申し訳ございません」と最初に伝える</li>
      <li>事実確認 → 解決策の提示（店長へ連絡も徹底）</li>
      <li>必ず復唱してズレをなくす（例：「○○ということで間違いないでしょうか？」）</li>
      <li>最後に感謝の言葉：「教えてくださりありがとうございます」</li>
    </ol>

    <strong>【よくあるクレーム例と対応】</strong>
    <ul class="steps">
      <li><strong>商品提供が遅い</strong><br>
        → 焼き台の状況確認  
        →「調理に○分ほどお時間いただいております」  
        → ドリンク無料などは店長判断
      </li>

      <li><strong>注文と違う商品が届いた</strong><br>
        → 即交換（優先対応）  
        → 調理場・ホールに共有して再発防止
      </li>

      <li><strong>接客が悪いと言われた</strong><br>
        → 否定しない  
        →「ご不快な思いをさせ申し訳ございません」  
        → 店長呼び出し
      </li>
    </ul>

    <div class="point">
      ✔ スタッフ判断で無断サービスはNG  
      ✔ 話を遮る・言い訳は絶対NG  
      ✔ 店長・責任者へのエスカレーションを徹底
    </div>
  </div>
  <div class="check-wrap">
    <input type="checkbox" class="check-item" data-key="クレーム対応" onclick="toggleCheck('クレーム対応')">
    <label for="chk-potato">この項目を理解しました</label>
  </div>
</div>

<!-- 強盗・暴力トラブル -->
<div class="section">
  <div class="header">
    <div>
        <div class="header-title recipe-name" data-recipe-id="強盗・暴力トラブル">強盗・暴力トラブル</div>
      <div class="sub-title">身の安全が最優先</div>
    </div>
    <div class="arrow">▶</div>
  </div>

  <div class="body">
    <strong>【基本原則】</strong>
    <ul class="steps">
      <li>身の安全が最優先（反抗・追跡しない）</li>
      <li>お金・物品は要求に応じて渡す</li>
      <li>刺激する言動をしない</li>
    </ul>

    <strong>【発生時の行動】</strong>
    <ol class="steps">
      <li>大声を出さない（犯人を刺激しない）</li>
      <li>近くのスタッフへ合図 → お客様を守る行動へ</li>
      <li>犯人に抵抗せず、逃走方向を“安全な範囲で”視認</li>
      <li>状況が落ち着いたらすぐ110番通報</li>
      <li>店長へ連絡 → 事実を共有</li>
    </ol>

    <strong>【絶対にやってはいけない】</strong>
    <ul class="steps">
      <li>追いかける</li>
      <li>スマホで撮影して近づく</li>
      <li>大声で威嚇する</li>
    </ul>

    <div class="point">
      ✔ 強盗時は「命の安全 ＞ 店の金品」  
      ✔ 必ず警察と店長へ早急に連絡  
    </div>
  </div>
  <div class="check-wrap">
    <input type="checkbox" class="check-item" data-key="強盗・暴力トラブル" onclick="toggleCheck('強盗・暴力トラブル')">
    <label for="chk-potato">この項目を理解しました</label>
  </div>
</div>

<!-- 商品入れ忘れ -->
<div class="section">
  <div class="header">
    <div>
        <div class="header-title recipe-name" data-recipe-id="商品の入れ忘れ（テイクアウト含む）">商品の入れ忘れ（テイクアウト含む）</div>
      <div class="sub-title">最も起こりやすいミス</div>
    </div>
    <div class="arrow">▶</div>
  </div>

  <div class="body">
    <strong>【発覚したら】</strong>
    <ol class="steps">
      <li>まずは事実確認（注文票と提供内容を照合）</li>
      <li>正しい商品を最優先で作成 → 提供</li>
      <li>テイクアウトの場合は電話連絡し謝罪</li>
      <li>店長にも即報告</li>
    </ol>

    <strong>【店での謝罪文例】</strong>
    <div class="point">
      「大変申し訳ございません。ご注文いただいた○○をお入れできていませんでした。すぐにご用意いたします。」
    </div>

    <strong>【再発防止】</strong>
    <ul class="steps">
      <li>商品受け渡し時に “2点確認” を徹底</li>
      <li>テイクアウトはチェックリストを使用</li>
    </ul>
  </div>
  <div class="check-wrap">
    <input type="checkbox" class="check-item" data-key="商品の入れ忘れ（テイクアウト含む）" onclick="toggleCheck('商品の入れ忘れ（テイクアウト含む）')">
    <label for="chk-potato">この項目を理解しました</label>
  </div>
</div>

<!-- お客様急病 -->
<div class="section">
  <div class="header">
    <div>
        <div class="header-title recipe-name" data-recipe-id="お客様の体調不良">お客様の体調不良</div>
      <div class="sub-title">安全確保が最優先</div>
    </div>
    <div class="arrow">▶</div>
  </div>

  <div class="body">
    <ol class="steps">
      <li>無理に動かさない。椅子に座らせる</li>
      <li>水分提供または静かな場所へ誘導</li>
      <li>意識が曖昧な場合は迷わず119番</li>
      <li>食べ物によるアレルギー反応が疑われる場合は救急要請</li>
      <li>店長へ早急に連絡</li>
    </ol>

    <div class="point">
      ✔ 救急車を呼ぶことをためらわない  
      ✔ アレルギーが疑われる場合は必ず119番
    </div>
  </div>
  <div class="check-wrap">
    <input type="checkbox" class="check-item" data-key="お客様の体調不良" onclick="toggleCheck('お客様の体調不良')">
    <label for="chk-potato">この項目を理解しました</label>
  </div>
</div>

<!-- 店内でのケガ -->
<div class="section">
  <div class="header">
    <div>
        <div class="header-title recipe-name" data-recipe-id="店内でのケガ・事故">店内でのケガ・事故</div>
      <div class="sub-title">転倒・火傷・切り傷など</div>
    </div>
    <div class="arrow">▶</div>
  </div>

  <div class="body">
    <ol class="steps">
      <li>お客様を安全な場所へ誘導</li>
      <li>応急処置（止血・冷却）</li>
      <li>状況によって救急車を要請</li>
      <li>事故場所の原因（濡れ・破損）をすぐ改善</li>
      <li>経緯を店長へ報告 → 事故記録を書く</li>
    </ol>

    <div class="point">
      ✔ ケガの原因を放置すると再発の危険 → 必ず改善  
      ✔ スタッフ間でも必ず情報共有
    </div>
  </div>
  <div class="check-wrap">
    <input type="checkbox" class="check-item" data-key="店内でのケガ・事故" onclick="toggleCheck('店内でのケガ・事故')">
    <label for="chk-potato">この項目を理解しました</label>
  </div>
</div>

<!-- 火災・ガス -->
<div class="section">
  <div class="header">
    <div>
        <div class="header-title recipe-name" data-recipe-id="火災・ガス漏れ">火災・ガス漏れ</div>
      <div class="sub-title">焼き台のある店舗で最重要項目</div>
    </div>
    <div class="arrow">▶</div>
  </div>

  <div class="body">
    <strong>【火災時】</strong>
    <ol class="steps">
      <li>無理に消そうとしない（初期消火できる場合のみ実施）</li>
      <li>店内に声をかけ、避難誘導を優先</li>
      <li>119番通報</li>
      <li>ガス元栓・電源OFF（可能な範囲で）</li>
      <li>店長へ連絡</li>
    </ol>

    <strong>【ガス漏れ時】</strong>
    <ol class="steps">
      <li>火気厳禁（ライター・コンロを使わない）</li>
      <li>窓を開け換気</li>
      <li>元栓を閉める</li>
      <li>お客様を避難誘導</li>
      <li>店長・ガス会社へ連絡</li>
    </ol>

    <div class="point">
      ✔ 火事・ガスは「大声でパニックを起こさせない」のが重要  
      ✔ スタッフで役割を分担し、冷静に対応
    </div>
  </div>
  <div class="check-wrap">
    <input type="checkbox" class="check-item" data-key="火災・ガス漏れ" onclick="toggleCheck('火災・ガス漏れ')">
    <label for="chk-potato">この項目を理解しました</label>
  </div>
</div>

</div>

<script>
document.querySelectorAll(".section").forEach(sec=>{
  sec.querySelector(".header").addEventListener("click",()=>{
    sec.classList.toggle("open");

    if(sec.classList.contains("open")){
      setTimeout(()=>{
        const rect = sec.getBoundingClientRect().top + window.scrollY;
        window.scrollTo({top: rect - 80, behavior: "smooth"});
      }, 20);
    }
  });
});
</script>

</body>
</html>
