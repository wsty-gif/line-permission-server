<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ドリンクマニュアル</title>
  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP",sans-serif;
      margin:0;background:#f8f9fa;color:#111;
      line-height:1.7;font-size:16px;
    }
    .wrapper{max-width:520px;margin:0 auto;padding:14px;}
    h1{text-align:center;font-size:20px;color:#e11d48;margin:6px 0 10px;}

    /* ===== アコーディオン（重要：直下だけ開く） ===== */
    .section{
      background:#fff;border-radius:12px;
      margin-bottom:14px;overflow:hidden;
      box-shadow:0 1px 6px rgba(0,0,0,0.1);
      border:1px solid rgba(0,0,0,0.04);
    }
    .header{
      padding:12px;display:flex;justify-content:space-between;gap:10px;
      cursor:pointer;user-select:none;background:#fff;align-items:center;
    }
    .header-title{font-size:16px;font-weight:600;}
    .arrow{transition:0.2s;flex:0 0 auto;}

    /* ★ここがポイント：openは「そのsection直下」だけ */
    .section > .body{display:none;padding:12px;background:#f9fafb;}
    .section.open > .body{display:block;}
    .section.open > .header .arrow{transform:rotate(90deg);}

    /* ===== 見た目（既存デザイン寄せ） ===== */
    .steps{margin:10px 0 0; padding-left:18px;}
    .steps li{margin-bottom:6px;font-size:14px;}
    .highlight-count{color:#dc2626;font-weight:700;}

    /* 写真 */
    .photo-box{
      margin:12px 0;
      padding:10px;
      background:#e5e7eb;
      border-radius:14px;
    }
    .photo-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap:8px;
    }
    .photo-grid img{
      width:100%;
      aspect-ratio: 4 / 3;
      height:auto;
      display:block;
      border-radius:10px;
      object-fit:cover;
      background:#d1d5db;
    }

    /* ポイント（仕込みなど） */
    .point{
      margin-top:10px;padding:10px;background:#fff7ed;
      border-left:4px solid #fb923c;border-radius:8px;
      font-size:14px;color:#b45309;
    }
    .prep-title{font-weight:700;margin-bottom:6px;}
    .prep-list{padding-left:18px;margin:0;}
    .prep-list li{margin-bottom:6px;line-height:1.6;}

    /* チェック */
    .check-wrap{
      margin-top:12px;
      padding:10px 12px;
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:10px;
      display:flex; align-items:center; gap:10px;
    }
    .check-item{transform:scale(1.2);}
    .check-text{font-size:14px;font-weight:600; cursor:pointer;}
  </style>

  <script>
    async function loadChecks() {
      const userId = window.MANUAL_USER_ID;
      const store  = window.MANUAL_STORE;

      if (!userId || !store) return;

      const res = await fetch(`/${store}/api/manual-check?userId=${userId}`);
      if (!res.ok) return;

      let data = {};
      try { data = await res.json(); } catch(e){ return; }

      document.querySelectorAll(".check-item").forEach(el => {
        const key = el.dataset.key;
        el.checked = data[key] === true;
      });
    }

    async function toggleCheck(key) {
      const userId = window.MANUAL_USER_ID;
      const store  = window.MANUAL_STORE;
      const type   = window.MANUAL_TYPE;

      const checkbox = document.querySelector(`.check-item[data-key="${key}"]`);
      const checked = checkbox ? checkbox.checked : false;

      await fetch(`/${store}/manual-check`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId, type, recipeId: key, checked })
      }).catch(()=>{});
    }

    window.addEventListener("DOMContentLoaded", () => {
      // 初期表示：すべて閉じる
      document.querySelectorAll(".section.open").forEach(s => s.classList.remove("open"));

      // アコーディオン：イベント委譲（ネストしても確実に動く）
      document.addEventListener("click", (e) => {
        const header = e.target.closest(".header");
        if (!header) return;

        // チェック周りクリックは開閉させない（誤爆防止）
        if (e.target.closest(".check-wrap")) return;

        const section = header.closest(".section");
        if (!section) return;

        section.classList.toggle("open");
      });

      // 「この項目を理解しました」文字クリックでチェックON/OFF
      document.addEventListener("click", (e) => {
        const label = e.target.closest(".check-text");
        if (!label) return;
        const wrap = label.closest(".check-wrap");
        const cb = wrap ? wrap.querySelector(".check-item") : null;
        if (!cb) return;
        cb.checked = !cb.checked;
        toggleCheck(cb.dataset.key);
      });

      loadChecks();
    });
  </script>
</head>

<body>
<div class="wrapper">
  <h1>ドリンクマニュアル</h1>

  <!-- ドリンク作成（第1階層） -->
  <div class="section">
    <div class="header">
      <div><div class="header-title">ドリンク作成</div></div>
      <div class="arrow">▶</div>
    </div>

    <div class="body">

      <!-- ソフトドリンク（第2階層） -->
      <div class="section">
        <div class="header">
          <div><div class="header-title">ソフトドリンク</div></div>
          <div class="arrow">▶</div>
        </div>

        <div class="body">

          <!-- ソフトドリンク各種 -->
          <div class="section">
            <div class="header">
              <div>
                <div class="header-title recipe-name" data-recipe-id="ソフトドリンク各種">
                  ソフトドリンク各種
                </div>
              </div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>グラスに氷を5つ入れる</li>
                <li>各種ソフトドリンクを注ぐ</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="ソフトドリンク各種" onclick="toggleCheck('ソフトドリンク各種')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

          <!-- カルピス -->
          <div class="section">
            <div class="header">
              <div>
                <div class="header-title recipe-name" data-recipe-id="カルピス">
                  カルピス
                </div>
              </div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>グラスに氷を5つ入れる</li>
                <li>ポンプを下まで2回押す</li>
                <li>水を入れる</li>
                <li>マドラーでよく混ぜる</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="カルピス" onclick="toggleCheck('カルピス')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- 焼酎（第2階層） -->
      <div class="section">
        <div class="header">
          <div><div class="header-title">焼酎</div></div>
          <div class="arrow">▶</div>
        </div>

        <div class="body">

          <!-- 焼酎ロック -->
          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="焼酎ロック">焼酎 ロック</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>ロックグラスに氷を5つ入れる</li>
                <li>ショット1回入れる</li>
                <li>マドラーで混ぜる</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="焼酎ロック" onclick="toggleCheck('焼酎ロック')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

          <!-- 焼酎水割り -->
          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="焼酎水割り">焼酎 水割り</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>焼酎用グラスに氷を5つ入れる</li>
                <li>ショット1回入れる</li>
                <li>水を上から1cmまで入れる</li>
                <li>マドラーで混ぜる</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="焼酎水割り" onclick="toggleCheck('焼酎水割り')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

          <!-- 焼酎ソーダ割り -->
          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="焼酎ソーダ割り">焼酎 ソーダ割り</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>焼酎用グラスに氷を5つ入れる</li>
                <li>ショット1回入れる</li>
                <li>ソーダを上から1cmまで入れる</li>
                <li>マドラーで混ぜる</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="焼酎ソーダ割り" onclick="toggleCheck('焼酎ソーダ割り')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

          <!-- 焼酎お湯割り -->
          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="焼酎お湯割り">焼酎 お湯割り</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>グラスにお湯を入れて温め、お湯を捨てる</li>
                <li>ショット1回入れる</li>
                <li>お湯を上から1cmまで入れる</li>
                <li>マドラーで混ぜる</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="焼酎お湯割り" onclick="toggleCheck('焼酎お湯割り')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- 梅酒（第2階層） -->
      <div class="section">
        <div class="header">
          <div><div class="header-title">梅酒</div></div>
          <div class="arrow">▶</div>
        </div>

        <div class="body">

          <!-- 梅酒ロック -->
          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="梅酒ロック">梅酒 ロック</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>ロックグラスに氷を5つ入れる</li>
                <li>ポンプ下まで4回押す</li>
                <li>マドラーで混ぜる</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="梅酒ロック" onclick="toggleCheck('梅酒ロック')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

          <!-- 梅酒水割り・ソーダ割り -->
          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="梅酒割り">梅酒 水・ソーダ割り</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>ソフトドリンクグラスに氷を5つ入れる</li>
                <li>ポンプ下まで4回押す</li>
                <li>水またはソーダを上から2cmまで入れる</li>
                <li>マドラーでよく混ぜる</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="梅酒割り" onclick="toggleCheck('梅酒割り')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

          <!-- 梅酒お湯割り -->
          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="梅酒お湯割り">梅酒 お湯割り</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>陶器グラスをお湯で温めて捨てる</li>
                <li>ポンプ下まで4回押す</li>
                <li>お湯を上から1cmまで入れる</li>
                <li>マドラーで混ぜる</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="梅酒お湯割り" onclick="toggleCheck('梅酒お湯割り')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- ビール・ハイボール（第2階層） -->
      <div class="section">
        <div class="header">
          <div><div class="header-title">ビール・ハイボール</div></div>
          <div class="arrow">▶</div>
        </div>

        <div class="body">

          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="生ビール">生ビール</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>Asahiロゴ「A」の頂点まで注ぐ</li>
                <li>「DRY」ロゴ下あたりまで泡をのせる</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="生ビール" onclick="toggleCheck('生ビール')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="フリージングハイボール">フリージングハイボール</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>専用グラスに氷を4つ入れる</li>
                <li>ディスペンサーで上から1cmまで注ぐ</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="フリージングハイボール" onclick="toggleCheck('フリージングハイボール')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="瓶ビール">瓶・ノンアル</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>栓を開ける</li>
                <li>咲蔵グラスと一緒に提供</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="瓶ビール" onclick="toggleCheck('瓶ビール')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="header">
              <div><div class="header-title recipe-name" data-recipe-id="澪ドライ">澪ドライ</div></div>
              <div class="arrow">▶</div>
            </div>
            <div class="body">
              <ol class="steps">
                <li>ボトルと吟醸グラスを席へ運ぶ</li>
                <li>お客様の前で開栓する</li>
              </ol>
              <div class="check-wrap">
                <input type="checkbox" class="check-item" data-key="澪ドライ" onclick="toggleCheck('澪ドライ')">
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>




</div>
</body>
</html>
