<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>串焼き店レシピマニュアル</title>
  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP",sans-serif;
      margin:0;background:#f8f9fa;color:#111;
      line-height:1.7;font-size:16px;
    }
    .wrapper{max-width:520px;margin:0 auto;padding:14px;}
    h1{text-align:center;font-size:20px;color:#e11d48;margin-bottom:8px;}
    .section{
      background:#fff;border-radius:12px;
      margin-bottom:14px;overflow:hidden;
      box-shadow:0 1px 6px rgba(0,0,0,0.1);
    }
    .header{
      padding:12px;display:flex;justify-content:space-between;
      cursor:pointer;user-select:none;
      background:#fff;
    }
    .header-title{font-size:16px;font-weight:600;}
    .arrow{transition:0.2s;}
    .open .arrow{transform:rotate(90deg);}
    .body{display:none;padding:12px;background:#f9fafb;}
    .open .body{display:block;}
    .img-box{
      margin-top:10px;border-radius:10px;background:#e5e7eb;
      padding:10px;display:flex;gap:10px;
    }
    .img-thumb{
      width:80px;height:80px;background:#d1d5db;
      border-radius:8px;display:flex;
      justify-content:center;align-items:center;
      font-size:12px;text-align:center;padding:4px;
    }
    .steps{margin-top:8px;}
    .steps li{margin-bottom:6px;font-size:14px;}
    .point{
      margin-top:10px;padding:10px;background:#fff7ed;
      border-left:4px solid #fb923c;border-radius:6px;
      font-size:14px;color:#b45309;
    }
    .sub-title{font-size:14px;color:#6b7280;margin-bottom:4px;}
    .highlight-count {
      color: #dc2626;
      font-weight: 700;
    }
    /* 写真エリア（nice_sweets風） */
    .photo-box {
      margin: 12px 0;
      padding: 10px;
      background: #e5e7eb;
      border-radius: 14px;
    }

    /* 画像グリッド */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 8px;
    }

    /* 写真そのもの */
    .photo-grid img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
      object-fit: cover;
      background: #d1d5db;
    }
    .prep-title {
      font-weight: 700;
      margin-bottom: 6px;
    }

    .prep-list {
      padding-left: 18px;
      margin: 0;
    }

    .prep-list li {
      margin-bottom: 6px;
      line-height: 1.6;
    }

  </style>
	<script>
		async function loadChecks() {
		const userId = window.MANUAL_USER_ID;
		const store  = window.MANUAL_STORE;

		if (!userId || !store) {
			console.warn("チェックロード不可: userId/store 不足");
			return;
		}

		const res = await fetch(
			`/${store}/api/manual-check?userId=${userId}`
		);

		// ❗ 失敗時は静かに終了
		if (!res.ok) {
			console.warn("manual-check 取得失敗");
			return;
		}

		let data = {};
		try {
			data = await res.json();
		} catch (e) {
			console.warn("manual-check JSON 解析失敗");
			return;
		}

		// ✅ ここで確実に反映
		document.querySelectorAll(".check-item").forEach(el => {
			const key = el.dataset.key;
			el.checked = data[key] === true;
		});
		}


		// チェック変更イベント
		async function toggleCheck(key) {
		const userId = window.MANUAL_USER_ID;
		const store  = window.MANUAL_STORE;
		const type   = window.MANUAL_TYPE;

		const checkbox = document.querySelector(
			`.check-item[data-key="${key}"]`
		);

		const checked = checkbox.checked; // ← ★ 追加（true / false）

		const res = await fetch(`/${store}/manual-check`, {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({
			userId,
			type,
			recipeId: key,
			checked            // ← ★ 送る
			})
		});

		const out = await res.json();
		console.log("CHECK UPDATED:", out);
		}


		window.addEventListener("DOMContentLoaded", loadChecks);
	</script>

	<script>
		function saveCheck(key) {
			toggleCheck(key);
		}
	</script>
</head>
<body>

<div class="wrapper">
  <h1>串焼きレシピマニュアル</h1>

	<div class="section">
		<div class="header"><div><div class="header-title">ドリンク</div></div><div class="arrow">▶</div></div>
		<div class="body">
      <!-- 1. ソフトドリンク -->
      <div class="section">
        <div class="header">
          <div>
            <div class="header-title recipe-name" data-recipe-id="ソフトドリンク">ソフトドリンク</div>
          </div>
          <div class="arrow">▶</div>
        </div>
        <div class="body">
          <strong>材料（1杯）</strong><br>
          ・ソフトドリンク：適量<br>
          ・氷：5つ  

          <div class="photo-box">
            <div class="photo-grid">
              <img src="/manuals/torisei_sakura/line/torisei_sakura/ウーロン茶_.jpg" alt="完成例">
            </div>
          </div>

          <ol class="steps">
            <li>ソフトドリンクグラスに氷を<span class="highlight-count">5つ</span>入れ、グラスに添わせながら注ぐ</li>
          </ol>

          <div class="check-wrap">
            <input type="checkbox" class="check-item" data-key="ソフトドリンク" onclick="toggleCheck('ソフトドリンク')">
            <span class="check-text">この項目を理解しました</span>
          </div>
        </div>
      </div>

      <!-- 2. カルピス -->
      <div class="section">
        <div class="header">
          <div>
            <div class="header-title recipe-name" data-recipe-id="カルピス">カルピス</div>
          </div>
          <div class="arrow">▶</div>
        </div>
        <div class="body">
          <strong>材料（1杯）</strong><br>
          ・カルピス：適量<br>
          ・水：適量<br>
          ・氷：5つ  

          <div class="photo-box">
            <div class="photo-grid">
              <img src="/manuals/torisei_sakura/line/torisei_sakura/カルピスウォーター.jpg" alt="完成例">
            </div>
          </div>

          <ol class="steps">
            <li>ソフトドリンクグラスに氷を<span class="highlight-count">5つ</span>入れ、ポンプを下3回（25×3）</li>
            <li>水を入れ、マドラーでよく混ぜる</li>
          </ol>

          <div class="point">
            ✔ 長ねぎは焼き過ぎると崩れるので裏返しは1回だけ  
            ✔ 肉は刺し過ぎずふんわり刺すと火が通りやすい
          </div>
          <div class="check-wrap">
            <input type="checkbox" class="check-item" data-key="カルピス" onclick="toggleCheck('カルピス')">
            <span class="check-text">この項目を理解しました</span>
          </div>
        </div>
      </div>
		</div>

    <div class="section">
      <div class="header"><div><div class="header-title">焼酎</div></div><div class="arrow">▶</div></div>
      <div class="body">
        <!-- 1. 焼酎 -->
        <div class="section">
          <div class="header">
            <div>
              <div class="header-title recipe-name" data-recipe-id="焼酎【ロック】">焼酎【ロック】</div>
            </div>
            <div class="arrow">▶</div>
          </div>
          <div class="body">
            <strong>材料（1杯）</strong><br>
            ・ソフトドリンク：適量<br>
            ・氷：5つ  

            <div class="photo-box">
              <div class="photo-grid">
                <img src="/manuals/torisei_sakura/line/torisei_sakura/ウーロン茶_.jpg" alt="完成例">
              </div>
            </div>

            <ol class="steps">
              <li>ソフトドリンクグラスに氷を<span class="highlight-count">5つ</span>入れ、グラスに添わせながら注ぐ</li>
            </ol>

            <div class="check-wrap">
              <input type="checkbox" class="check-item" data-key="焼酎【ロック】" onclick="toggleCheck('焼酎【ロック】')">
              <span class="check-text">この項目を理解しました</span>
            </div>
          </div>
        </div>

        <!-- 2. カルピス -->
        <div class="section">
          <div class="header">
            <div>
              <div class="header-title recipe-name" data-recipe-id="カルピス">カルピス</div>
            </div>
            <div class="arrow">▶</div>
          </div>
          <div class="body">
            <strong>材料（1杯）</strong><br>
            ・カルピス：適量<br>
            ・水：適量<br>
            ・氷：5つ  

            <div class="photo-box">
              <div class="photo-grid">
                <img src="/manuals/torisei_sakura/line/torisei_sakura/カルピスウォーター.jpg" alt="完成例">
              </div>
            </div>

            <ol class="steps">
              <li>ソフトドリンクグラスに氷を<span class="highlight-count">5つ</span>入れ、ポンプを下3回（25×3）</li>
              <li>水を入れ、マドラーでよく混ぜる</li>
            </ol>

            <div class="point">
              ✔ 長ねぎは焼き過ぎると崩れるので裏返しは1回だけ  
              ✔ 肉は刺し過ぎずふんわり刺すと火が通りやすい
            </div>
            <div class="check-wrap">
              <input type="checkbox" class="check-item" data-key="カルピス" onclick="toggleCheck('カルピス')">
              <span class="check-text">この項目を理解しました</span>
            </div>
          </div>
        </div>
      </div>
    </div>

	</div>

  <div class="section">
    <!-- フード -->
    <div class="header">
      <div>
        <div class="header-title">フード</div>
      </div>
      <div class="arrow">▶</div>
    </div>

    <div class="body">

      <!-- 創作小皿カテゴリ -->
      <div class="section">
        <div class="header">
          <div>
            <div class="header-title">創作小皿</div>
          </div>
          <div class="arrow">▶</div>
        </div>

        <div class="body">

          <!-- 創作小皿 -->
          <div class="section">
            <div class="header">
              <div>
                <div class="header-title recipe-name" data-recipe-id="豚トロチャーシュー">
                  豚トロチャーシュー
                </div>
              </div>
              <div class="arrow">▶</div>
            </div>

            <div class="body">
              <strong>材料</strong><br>
              ・豚トロチャーシュー：70g<br>
              ・タレ：10cc<br>
              ・たまねぎスライス：20g<br>
              ・からし：2g<br>
              ・きざみねぎ<br>
              ・糸とうがらし<br>

              <div class="photo-box">
                <div class="photo-grid">
                  <img src="/manuals/torisei_sakura/line/torisei_sakura/豚トロチャーシュー.jpg" alt="完成例">
                </div>
              </div>

              <ol class="steps">
                <li>豚トロチャーシュースライス70ｇ（7枚）をレンジで７秒温める</li>
                <li>1をバーナーであぶる</li>
                <li>玉ねぎスライスを皿に盛り、2を盛り付ける</li>
                <li>上からたれをかけて皿のふちにからしを乗せる</li>
                <li>きざみねぎ、糸唐辛子をトッピングする</li>
              </ol>

              <div class="point">
                <div class="prep-title">仕込み</div>
                <ol class="prep-list">
                  <li>
                    グレープフルーツジュース200cc・しょうゆ200cc・砂糖100gを合わせ、
                    豚トロ5枚（約2kg分）を入れて<strong>1日漬け込む</strong>
                  </li>
                  <li>
                    漬け汁を切り、鉄板で<strong>両面に焼き目</strong>をつける
                  </li>
                  <li>
                    アルミで包み、<strong>保温機に入れる</strong>
                  </li>
                  <li>
                    粗熱が取れたら<strong>冷蔵保存</strong>
                  </li>
                  <li>
                    残った漬け汁は<strong>半量まで煮詰めて「かけダレ」</strong>にする
                  </li>
                  <li>
                    豚トロを<strong>1枚10g</strong>にスライスする
                  </li>
                </ol>
              </div>

              <div class="check-wrap">
                <input
                  type="checkbox"
                  class="check-item"
                  data-key="豚トロチャーシュー"
                  onclick="toggleCheck('豚トロチャーシュー')"
                >
                <span class="check-text">この項目を理解しました</span>
              </div>
            </div>
          </div>
          <!-- /創作小皿 -->

        </div>
      </div>
      <!-- /メイン -->

    </div>
  </div>


</div>

<script>
  document.querySelectorAll(".header").forEach(header => {
    header.addEventListener("click", (e) => {
      e.stopPropagation(); // ← ★ これが最重要

      const section = header.closest(".section");
      const isOpen = section.classList.contains("open");

      // 開閉トグル
      section.classList.toggle("open");

      // すでに開いていた場合はスクロールしない
      if (isOpen) return;

      // 開いたときだけ位置調整
      setTimeout(() => {
        const rect = section.getBoundingClientRect().top + window.scrollY;
        const offset = 80;
        window.scrollTo({
          top: rect - offset,
          behavior: "smooth"
        });
      }, 10);
    });
  });
</script>


</body>
</html>
