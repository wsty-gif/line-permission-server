<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>オペレーションマニュアル</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP",sans-serif;margin:0;background:#f8f9fa;color:#111;line-height:1.7;font-size:16px;}
    .wrapper{max-width:520px;margin:0 auto;padding:14px;}
    h1{text-align:center;font-size:20px;color:#16a34a;margin-bottom:10px;}

    .section{background:#fff;border-radius:12px;margin-bottom:14px;overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,0.1);}
    .header{padding:12px;display:flex;justify-content:space-between;cursor:pointer;user-select:none;}
    .header-title{font-size:16px;font-weight:600;}
    .sub-title{font-size:13px;color:#6b7280;margin-top:2px;}
    .arrow{transition:0.2s;}
    .open .arrow{transform:rotate(90deg);}
    .body{display:none;padding:12px;background:#f9fafb;}
    .open .body{display:block;}

    .steps{margin-top:8px;padding-left:18px;}
    .steps li{margin-bottom:8px;font-size:14px;}

    .img-box{margin-top:10px;border-radius:10px;background:#e5e7eb;padding:10px;display:flex;gap:10px;}
    .img-thumb{width:80px;height:80px;background:#d1d5db;border-radius:8px;display:flex;justify-content:center;align-items:center;font-size:12px;text-align:center;padding:4px;}
    .point{margin-top:10px;padding:10px;background:#fff7ed;border-left:4px solid #fb923c;border-radius:6px;font-size:14px;color:#b45309;}

  </style>

<script>
    async function loadChecks() {
      const userId = window.MANUAL_USER_ID;
      const store  = window.MANUAL_STORE;
      const type   = window.MANUAL_TYPE;

      if (!userId || !store || !type) {
        console.warn("チェックロード不可: userId/store/type が不足");
        return;
      }

      const res = await fetch(
        `/${store}/api/manual-check?userId=${userId}&type=${type}`
      );
      // 🔽 JSON 以外は無視（HTMLが返ってきても落ちない）
      const contentType = res.headers.get("content-type") || "";
      if (!contentType.includes("application/json")) {
        console.warn("manual-check が JSON を返していません");
        return;
      }

      const data = await res.json();

      // 反映
      document.querySelectorAll(".check-item").forEach(el => {
        const key = el.dataset.key;
        el.checked = data[key] === true;
      });
    }


    // チェック変更イベント
    async function toggleCheck(key) {
      const userId = window.MANUAL_USER_ID;
      const store  = window.MANUAL_STORE;   // ← これを必ず使う
      const type   = window.MANUAL_TYPE;

      if (!userId || !store || !type) {
        console.warn("toggleCheck: 必要な情報が不足しています");
        return;
      }

      const res = await fetch(`/${store}/manual-check`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          userId,
          type,
          recipeId: key
        })
      });

      const out = await res.json();
      console.log("CHECK UPDATED:", out);
    }

    window.addEventListener("DOMContentLoaded", loadChecks);
  </script>

  <script>
    function saveCheck(key) {
      toggleCheck(key);
    }
  </script>

</head>

<body>
<div class="wrapper">

  <h1>オペレーションマニュアル</h1>
  <p style="text-align:center;font-size:13px;color:#6b7280;margin-bottom:16px;">
    接客・清掃・開店/閉店作業の基本手順
  </p>

  <!-- 接客 -->
  <div class="section">
    <div class="header">
      <div>
        <div class="header-title recipe-name" data-recipe-id="接客の基本">接客の基本</div>
        <div class="sub-title">挨拶・ご案内・提供・退店まで</div>
      </div>
      <div class="arrow">▶</div>
    </div>
    <div class="body">

      <strong>【入店対応】</strong>
      <ol class="steps">
        <li>お客様が来店したら 3秒以内に「いらっしゃいませ！」</li>
        <li>人数を確認 → テーブルへご案内</li>
        <li>メニューをお渡しし「ご注文がお決まりになりましたらお呼びください」</li>
      </ol>

      <strong>【オーダー対応】</strong>
      <ol class="steps">
        <li>復唱は必ず「語尾までハッキリ」</li>
        <li>注文をハンディに正確に入力</li>
        <li>料理提供時は「〇〇になります。熱いのでお気をつけください」など一言添える</li>
      </ol>

      <strong>【退店時】</strong>
      <ol class="steps">
        <li>お客様が席を立ったら「ありがとうございました！」</li>
        <li>テーブルの片付けをすぐ実施（提供皿・串・グラス）</li>
        <li>テーブルセットを整え、次のお客様に備える</li>
      </ol>

      <div class="img-box">
        <div class="img-thumb">接客画像</div>
        <div><strong>接客姿勢の例</strong><br>背筋を伸ばし笑顔で対応。</div>
      </div>

      <div class="point">
        ✔ 接客で最重要なのは「表情・声のトーン・気づき」  
        ✔ 手が空いたら巡回し、焼き台やホールの状況を常に把握する
      </div>
      <div class="check-wrap">
        <input type="checkbox" class="check-item" data-key="接客の基本" onclick="toggleCheck('接客の基本')">
        <span class="check-text">この項目を理解しました</span>
      </div>
    </div>
  </div>

  <!-- トイレ掃除 -->
  <div class="section">
    <div class="header">
      <div>
        <div class="header-title recipe-name" data-recipe-id="トイレ清掃">トイレ清掃</div>
        <div class="sub-title">汚れが最も気づかれやすい場所</div>
      </div>
      <div class="arrow">▶</div>
    </div>

    <div class="body">
      <strong>【頻度】</strong>  
      ・開店前  
      ・ピーク後（21:00頃）  
      ・閉店前  

      <strong style="display:block;margin-top:10px;">【清掃手順】</strong>
      <ol class="steps">
        <li>換気扇ON、トイレットペーパー残量を確認</li>
        <li>ゴミ箱の中身を捨てる</li>
        <li>便座・便器周りを消毒スプレー → ペーパーで拭く</li>
        <li>床をモップ or ウエットシートで拭く</li>
        <li>手洗い場の水滴・鏡の汚れを除去</li>
        <li>芳香剤の位置調整・補充</li>
      </ol>

      <div class="img-box">
        <div class="img-thumb">トイレ掃除</div>
        <div><strong>注意ポイント</strong><br>便座裏・床の角は忘れがち。</div>
      </div>

      <div class="point">
        ✔ トイレの清潔感は店の評価に直結  
        ✔ 必ず「清掃しましたカード」を立てる  
        ✔ トイレの汚れを見つけたら“すぐ対応”
      </div>

      <div class="check-wrap">
        <input type="checkbox" class="check-item" data-key="トイレ清掃" onclick="toggleCheck('トイレ清掃')">
        <span class="check-text">この項目を理解しました</span>
      </div>
    </div>
  </div>

  <!-- ホール巡回 -->
  <div class="section">
    <div class="header">
      <div>
        <div class="header-title">3. ホール巡回</div>
        <div class="sub-title">気づき力が売上と満足度を上げる</div>
      </div>
      <div class="arrow">▶</div>
    </div>
    <div class="body">
      <ol class="steps">
        <li>テーブルの空き皿・串を見つけたらすぐ下げる</li>
        <li>ドリンク残量が減っていたら「追加いかがですか？」</li>
        <li>焼台が混んでいれば提供フォローへ</li>
        <li>お客様同士が呼びかけている場合は必ず気づいて声をかける</li>
        <li>汚れた箇所（床・テーブル）を即時掃除</li>
      </ol>

      <div class="point">
        ✔ ホールは「歩いて確認し続ける」のが基本  
        ✔ 声かけは店の雰囲気を大きく左右する  
        ✔ 無表情禁止（常にやわらかい顔）
      </div>
    </div>
  </div>

  <!-- 開店準備 -->
  <div class="section">
    <div class="header">
      <div>
        <div class="header-title recipe-name" data-recipe-id="開店準備">開店準備</div>
        <div class="sub-title">営業がスムーズに始まるための準備</div>
      </div>
      <div class="arrow">▶</div>
    </div>

    <div class="body">
      <ol class="steps">
        <li>レジ立ち上げ → 釣銭確認</li>
        <li>ホール照明・音楽・換気チェック</li>
        <li>テーブルセット（箸・おしぼり・調味料）</li>
        <li>焼台の火入れ → 温度チェック</li>
        <li>ドリンク補充（氷・ジョッキ冷え具合）</li>
        <li>トイレチェック</li>
      </ol>

      <div class="point">
        ✔ 最初の30分が店の印象を作る  
        ✔ 焼台・ホール・レジの担当を明確に分けると効率が上がる
      </div>
      <div class="check-wrap">
        <input type="checkbox" class="check-item" data-key="開店準備" onclick="toggleCheck('開店準備')">
        <span class="check-text">この項目を理解しました</span>
      </div>
    </div>
  </div>

  <!-- 閉店作業 -->
  <div class="section">
    <div class="header">
      <div>
        <div class="header-title recipe-name" data-recipe-id="閉店作業">閉店作業</div>
        <div class="sub-title">ミス防止と翌日の効率UP</div>
      </div>
      <div class="arrow">▶</div>
    </div>

    <div class="body">
      <ol class="steps">
        <li>レジ締め・売上確認</li>
        <li>テーブル＆床掃除（モップ・ゴミ回収）</li>
        <li>トイレ清掃 → 紙・洗剤の補充</li>
        <li>焼台の灰処理・後片付け</li>
        <li>冷蔵庫内の確認（串の残数・廃棄判断）</li>
        <li>電源・照明を順番にオフ</li>
      </ol>

      <div class="point">
        ✔ 閉店前に“明日の必要串の量”を確認しておくと仕込みが楽  
        ✔ 貴重品・売上の扱いは必ずマニュアル通りに
      </div>
      <div class="check-wrap">
        <input type="checkbox" class="check-item" data-key="閉店作業" onclick="toggleCheck('閉店作業')">
        <span class="check-text">この項目を理解しました</span>
      </div>
    </div>
  </div>

</div>

<script>
  document.querySelectorAll(".section").forEach(sec=>{
    sec.querySelector(".header").addEventListener("click",()=>{
      sec.classList.toggle("open");

      // 開いたときにスクロール位置補正
      if(sec.classList.contains("open")){
        setTimeout(()=>{
          const rect = sec.getBoundingClientRect().top + window.scrollY;
          window.scrollTo({top: rect - 80, behavior: "smooth"});
        }, 20);
      }
    });
  });
</script>

</body>
</html>
